
{% extends 'base.html' %}
    
{% block content %}
 
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <div class="alert-messages" id="error-message">
    {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
    </div>
  {% endif %}
{% endwith %}


    <div id="error-message" class="error-message" style="display: none;">
    </div>

    <div  id="overlayBackground"class="mainbody overlay-background">
    <div class="fileticketform">
        <div class="headerservic"> ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© </div>
    <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <div class="section-title">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>

    <div class="form-container">
        <!-- Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ± -->
        <div class="form-row">
            <div class="input-group">
                <label class="field-label" for="first-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</label>
                <input type="text" class="input-box" name="first_name" value="{{ user_data.first_name }}" readonly>
            </div>
            <div class="input-group">
                <label class="field-label" for="last-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ±</label>
                <input type="text" name="last_name" class="input-box" value="{{ user_data.last_name }}" readonly>

            </div>
        </div>

        <!-- Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© -->
        <div class="form-row">
            <div class="input-group">
                <label class="field-label" for="id-number">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                <input type="text" name="id_number" class="input-box"  value="{{ user_data.id_number }}" readonly>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ -->
    <div class="section-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</div>

    <div class="form-container">
        <!--  Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ -->
        <div class="form-row">
            <div class="input-group">
                <label class="field-label" for="email">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
                <input type="email" id="email" class="input-box">
            </div>
            <div class="input-group">
                <label class="field-label" for="phone">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
                <input type="text" id="phone" name="mobile_number" class="input-box" value="{{ user_data.mobile_number }}" >
            </div>
        </div>
    </div>


    <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
    <div class="section-title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</div>

    <div class="form-container">
        <!--  Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø© -->
        <div class="form-row">
            <div class="input-group">
                <label class="field-label" for="region">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                <select id="region" class="input-box" onchange="updateCities()">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
                    <option value="Ù…ÙƒØ©">Ù…ÙƒØ©</option>
                    <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                    <option value="Ø§Ù„Ø´Ø±Ù‚ÙŠØ©">Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
                    <option value="Ø¹Ø³ÙŠØ±">Ø¹Ø³ÙŠØ±</option>
                    <option value="ØªØ¨ÙˆÙƒ">ØªØ¨ÙˆÙƒ</option>
                    <option value="Ø­Ø§Ø¦Ù„">Ø­Ø§Ø¦Ù„</option>
                    <option value="Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©">Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©</option>
                    <option value="Ø¬Ø§Ø²Ø§Ù†">Ø¬Ø§Ø²Ø§Ù†</option>
                    <option value="Ø§Ù„Ø¨Ø§Ø­Ø©">Ø§Ù„Ø¨Ø§Ø­Ø©</option>
                    <option value="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</option>
                    <option value="Ø§Ù„Ø¬ÙˆÙ">Ø§Ù„Ø¬ÙˆÙ</option>
                    <option value="Ù†Ø¬Ø±Ø§Ù†">Ù†Ø¬Ø±Ø§Ù†</option>
                </select>
            </div>
            <div class="input-group">
                <label class="field-label" for="city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                <select id="city" class="input-box">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ø¯Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© -->
                </select>
            </div>
        </div>
    </div>

<!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø¹ -->
<h2 class="section-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ°ÙƒØ±Ø©</h2>
<div class="form-row">
    <textarea class="ticket-text" id="complaint" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„ØªØ°ÙƒØ±Ø© Ù‡Ù†Ø§..."></textarea>
    <div class="upload-box">
        <div class="upload-area">
            <span class="upload-icon">ğŸ“</span>
            <span class="upload-text">Ø§Ù†Ù‚Ø± Ù„Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ù„ÙØ§Øª</span>
            <input type="file" class="upload-input" multiple accept=".jpg,.jpeg,.png,.pdf,.doc,.docx" onchange="displayFileNames(event)"">
        </div>
    </div>
</div>

<div id="file-list" class="file-list"></div>
<!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø®Ø§Ù…Ø³ - Ø²Ø± Ø±ÙØ¹ Ø§Ù„ØªØ°ÙƒØ±Ø© -->
<div class="form-section">
    <button class="submit-button" onclick="submitComplaint()">Ø±ÙØ¹ Ø§Ù„ØªØ°ÙƒØ±Ø©</button>
</div>

</div>

</div>

    </div> 
    <div id="cont">
        

    </div>
    <script>

        
        async function submitComplaint() {
            const complaintText = document.getElementById('complaint').value;
            const emailValue = document.getElementById('email').value;
            const PhoneValue = document.getElementById('phone').value;
        
            console.log("Data being sent:", { complaintText, emailValue, PhoneValue });
        
            if (!complaintText || !emailValue || !PhoneValue) {
                alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
                return;
            }
        
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        complaint: complaintText,
                        email: emailValue,
                        phone: PhoneValue
                    })
                });
        
                const result = await response.json();
        
                if (response.ok) {
                    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                    const  resultContainer = document.getElementById('cont');
                    resultContainer.innerHTML = `<div id="result">
                        
                        <div id="HeaderResult">
                            <i>Ù…Ø±Ø­Ø¨Ø§ 
                            {{ user_data.first_name }}
                            {{ user_data.last_name }}
                            </i>
                            ØªÙØ§ØµÙŠÙ„ ØªØ°ÙƒØ±ØªÙƒ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…ÙˆØ¶Ø­ Ø¨Ø§Ù„Ø§Ø³ÙÙ„
                        </div>
                        <div id="AuthResult">
                            <i>Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®ØªØµØ©:</i>
                            ${result.authority}
                        </div>
                         <div id="DepartmentResult">
                            <i>Ø§Ù„Ø¥Ø®ØªØµØ§Øµ:</i>
                            ${result.specialization}
                        </div>
                        <div id="SeverityResult">
                            <i>Ø§Ù„Ø£Ù‡Ù…ÙŠØ©:</i>
                            ${result.severity}
                        </div>
                       <form method="POST" action="{{ url_for('confirm_ticket') }}">
                            {% if decision_form %}
                                {{ decision_form.hidden_tag() }}
                            {% endif %}
                            <div id="userDecision">
                                {{ decision_form.submit(class="btn acceptbtn") }}  <!-- Ø²Ø± Ù…ÙˆØ§ÙÙ‚ -->
                                {{ decision_form.reject(class="btn rejectbtn") }}  <!-- Ø²Ø± Ø±ÙØ¶ -->
                            </div>
                        </form>


                    </div>`;
                } else {
                    const errorContainer = document.getElementById('error-message');
                    errorContainer.innerHTML = `
            <div class="error-message">
            <svg width="50px" height="50px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                    <g id="style=doutone">
                        <g id="error-box">
                            <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M1.25 8C1.25 4.27208 4.27208 1.25 8 1.25H16C19.7279 1.25 22.75 4.27208 22.75 8V16C22.75 19.7279 19.7279 22.75 16 22.75H8C4.27208 22.75 1.25 19.7279 1.25 16V8ZM8 2.75C5.10051 2.75 2.75 5.10051 2.75 8V16C2.75 18.8995 5.10051 21.25 8 21.25H16C18.8995 21.25 21.25 18.8995 21.25 16V8C21.25 5.10051 18.8995 2.75 16 2.75H8Z" fill="#f00f0f"></path>
                            <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M8.46967 8.46967C8.76257 8.17678 9.23744 8.17678 9.53033 8.46967L15.5303 14.4697C15.8232 14.7626 15.8232 15.2374 15.5303 15.5303C15.2374 15.8232 14.7625 15.8232 14.4696 15.5303L8.46967 9.53033C8.17678 9.23743 8.17678 8.76256 8.46967 8.46967Z" fill="#fb7979"></path>
                            <path id="vector (Stroke)_3" fill-rule="evenodd" clip-rule="evenodd" d="M15.5303 8.46967C15.8232 8.76257 15.8232 9.23744 15.5303 9.53033L9.53033 15.5303C9.23743 15.8232 8.76256 15.8232 8.46967 15.5303C8.17678 15.2374 8.17678 14.7625 8.46967 14.4696L14.4697 8.46967C14.7626 8.17678 15.2374 8.17678 15.5303 8.46967Z" fill="#fb7979"></path>
                        </g>
                    </g>
                </g>
            </svg>
            ${result.error}
        </div>`;
        errorContainer.style.display = 'block';
                }
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = `
                <div>    
                <svg width="64px" height="64px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier"> <g id="style=doutone"> <g id="error-box"> <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M1.25 8C1.25 4.27208 4.27208 1.25 8 1.25H16C19.7279 1.25 22.75 4.27208 22.75 8V16C22.75 19.7279 19.7279 22.75 16 22.75H8C4.27208 22.75 1.25 19.7279 1.25 16V8ZM8 2.75C5.10051 2.75 2.75 5.10051 2.75 8V16C2.75 18.8995 5.10051 21.25 8 21.25H16C18.8995 21.25 21.25 18.8995 21.25 16V8C21.25 5.10051 18.8995 2.75 16 2.75H8Z" fill="#f00f0f"></path> <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" 
                    d="M8.46967 8.46967C8.76257 8.17678 9.23744 8.17678 9.53033 8.46967L15.5303 14.4697C15.8232 14.7626 15.8232 15.2374 15.5303 15.5303C15.2374 15.8232 14.7625 15.8232 14.4696 15.5303L8.46967 9.53033C8.17678 9.23743 8.17678 8.76256 8.46967 8.46967Z" fill="#fb7979"></path> <path id="vector (Stroke)_3" fill-rule="evenodd" clip-rule="evenodd" d="M15.5303 8.46967C15.8232 8.76257 15.8232 9.23744 15.5303 9.53033L9.53033 15.5303C9.23743 15.8232 8.76256 15.8232 8.46967 15.5303C8.17678 15.2374 8.17678 14.7625 8.46967 14.4696L14.4697 8.46967C14.7626 8.17678 15.2374 8.17678 15.5303 8.46967Z" fill="#fb7979"></path> </g> </g> </g></svg>
                    </div> 
                    Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´ÙƒÙˆÙ‰. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
                    ` ;
                errorContainer.style.display = 'block';
            }
        }



        
    </script>
    {% endblock content %}
